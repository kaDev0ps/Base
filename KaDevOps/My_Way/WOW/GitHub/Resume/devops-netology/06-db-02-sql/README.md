# [Домашнее задание](https://github.com/a-prokopyev-resume/virt-homeworks/tree/virt-11/06-db-02-sql) к [занятию 2. «SQL»](https://netology.ru/profile/program/bd-dev-27/lessons/275711/lesson_items/1477589)## Введение[Дополнительные материалы, рекомендованные Нетологией](https://github.com/netology-code/virt-homeworks/blob/virt-11/additional/README.md).Решение:Вся эта работа выполнена в виде IaC скриптов, запуская которые необходимые задачи решаются за 2 минуты, начиная с поднятия контейнеров без начального состояния (volumes пустые) и заканчивая их полным удалением вместе с содержимым volumes:   * Работа с контейнерами осуществляется моим скриптом: [compose.sh](src/compose.sh)   * Работа с СУБД осуществляется моим скриптом: [dbms.sh](src/dbms.sh)  Для выполнения этой работы достаточно запустить мой скрипт [tasks.sh](src/tasks.sh), конец которого показан далее:```task1;task2;task3;task4;task5;task6;clean_service_state postgres;```В каждой задаче я буду показывать часть лога, демонстрирующего выполнение соответствующих задач.## Задача 1Содержимое моего манифеста [docker-compose.yml](src/docker-compose.yml):```version: '3.6'services:  postgres:    container_name: PostgreSQL    image: postgres:12.16-bullseye    environment:      - POSTGRES_USER=${DB_USER}      - POSTGRES_PASSWORD=${DB_PASSWORD}      - POSTGRES_DB=${DB_NAME}      - PGDATA=${CONT_DATA_DIR_postgres}    ports:      - "5432:5432"    volumes:      - ${HOST_DATA_DIR}/postgres:/${CONT_DATA_DIR_postgres}      - ${HOST_BACKUP_DIR}:${CONT_BACKUP_DIR}  postgres2:    container_name: PostgreSQL2    image: postgres:12.16-bullseye    environment:       - POSTGRES_USER=${DB_USER}      - POSTGRES_PASSWORD=${DB_PASSWORD}      - POSTGRES_DB=${DB_NAME}      - PGDATA=${CONT_DATA_DIR_postgres}    ports:      - "5432:5432"    volumes:      - ${HOST_DATA_DIR}/postgres2:/${CONT_DATA_DIR_postgres}      - ${HOST_BACKUP_DIR}:${CONT_BACKUP_DIR}  mysql:    container_name: MySQL    image: mysql:8.0.34-debian    environment:      - MYSQL_DATABASE=${DB_NAME}      - MYSQL_ROOT_PASSWORD=${DB_PASSWORD}    volumes:      - ${HOST_DATA_DIR}/mysql:/${CONT_DATA_DIR_mysql}      - ${HOST_BACKUP_DIR}:${CONT_BACKUP_DIR}/      - ${HOST_CONFIG_DIR}/mysql:/etc/mysql/conf.d # ${CONT_CONFIG_DIR_mysql}    ports:     - "3306:3306"  gui:    container_name: AdminGUI    image: adminer:4.8.1-standalone    command: php -S 0.0.0.0:8080 -t /var/www/html # to avoid IPv6 binding#    depends_on:#      - postgres#      - mysql    restart: always    environment:      ADMINER_DEFAULT_SERVER: postgres    ports:      - "8080:8080"```Содержимое функции task1:```task1(){        clean_service_state postgres;        ./compose.sh start postgres;        ./dbms.sh pg "" wait_ready;}```Сначала удаляется старый контейнер вместе с содержимым volumes, потом контейнер создаётся и запускается заново, после чего скрипт ожидает готовности сервиса PostgreSQL для обработки запросов.Лог выполнения скрипта:```05:15 root@chimaera /download/netology 569:# > ./tasks.sh ===> Debug at Mon 23 Oct 2023 05:15:18 AM UTC:+++ docker-compose stop postgresCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES===> Debug at Mon 23 Oct 2023 05:15:19 AM UTC:Total reclaimed space: 0BCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES===> Debug at Mon 23 Oct 2023 05:15:20 AM UTC:+++ docker-compose up -d postgresCreating network "netology_default" with the default driverCreating PostgreSQL ... doneCONTAINER ID   IMAGE                     COMMAND                  CREATED         STATUS                  PORTS                    NAMES27c8265e30b6   postgres:12.16-bullseye   "docker-entrypoint.s…"   4 seconds ago   Up Less than a second   0.0.0.0:5432->5432/tcp   PostgreSQL===> Waiting DBMS to start at Mon 23 Oct 2023 05:15:26 AM UTC:/var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - rejecting connections ... waiting 1s ... /var/run/postgresql:5432 - accepting connections```## Задача 2Содержимое функции task2:```task2(){        postgres_script task2a.sql docker-compose.env admin.env;        (                       source admin.env;                if (  postgres_cmd "SELECT 1 FROM pg_database WHERE datname = "\'$DB_NAME\' | grep rows | grep -q 1); then                        echo "Database already exists";                else                        postgres_cmd "CREATE DATABASE \"$DB_NAME\" ";                        postgres_cmd "GRANT ALL PRIVILEGES ON DATABASE \"$DB_NAME\" to \"$DB_USER\" WITH GRANT OPTION ";                fi;        );        postgres_script task2b.sql admin.env user.env;        show_db_objects admin.env;}```Скрипт использует файлы [task2a.sql](src/task2a.sql) и [task2b.sql](src/task2b.sql) с DDL операторами создаваемой структуры базы данных.Лог выполнения скрипта:```===> SQL query text at Mon 23 Oct 2023 05:15:51 AM UTC:-- DO $$ BEGIN CREATE TABLE IF NOT EXISTS Orders(    ID SERIAL PRIMARY KEY,    Name VARCHAR(255),    Price INTEGER);CREATE TABLE IF NOT EXISTS Clients(    ID SERIAL PRIMARY KEY,    Name VARCHAR(255),    Country VARCHAR(255),    Order_ID INTEGER CONSTRAINT Client_Order_FK REFERENCES Orders (ID) ON DELETE CASCADE ON UPDATE NO ACTION);CREATE INDEX Clients_Country ON Clients(Country);CREATE USER "test-simple-user" WITH PASSWORD 'netology_user';REVOKE ALL PRIVILEGES ON DATABASE "test-db" from "test-simple-user";GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA "public" to "test-simple-user";-- GRANT USAGE, SELECT ON SEQUENCE clients_id_seq TO user1;GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA "public" TO "test-simple-user";-- GRANT SELECT, INSERT, UPDATE, DELETE ON orders, clients TO "test-simple-user";-- GRANT ALL ON Orders TO "test-simple-user";-- GRANT ALL ON Clients TO "test-simple-user";GRANT CONNECT ON DATABASE "test-db" TO "test-simple-user";GRANT USAGE ON SCHEMA public TO "test-simple-user";-- END $$;CREATE OR REPLACE PROCEDURE UpdateClient(ClientName VARCHAR(255), OrderName VARCHAR(255))LANGUAGE SQLAS $$        UPDATE Clients         SET Order_id = (SELECT ID from Orders WHERE Orders.name=OrderName)         WHERE Clients.Name=ClientName;$$;===> DBMS response at Mon 23 Oct 2023 05:15:51 AM UTC:CREATE TABLECREATE TABLECREATE INDEXCREATE ROLEREVOKEGRANTGRANTGRANTWARNING:  no privileges were granted for "public"GRANTCREATE PROCEDURE===> Command text at Mon 23 Oct 2023 05:15:52 AM UTC:SELECT * FROM pg_database===> DBMS response at Mon 23 Oct 2023 05:15:52 AM UTC:  oid  |  datname  | datdba | encoding | datcollate |  datctype  | datistemplate | datallowconn | datconnlimit | datlastsysoid | datfrozenxid | datminmxid | dattablespace |                                                   datacl                                                    -------+-----------+--------+----------+------------+------------+---------------+--------------+--------------+---------------+--------------+------------+---------------+------------------------------------------------------------------------------------------------------------- 13458 | postgres  |     10 |        6 | en_US.utf8 | en_US.utf8 | f             | t            |           -1 |         13457 |          480 |          1 |          1663 |  16384 | test      |     10 |        6 | en_US.utf8 | en_US.utf8 | f             | t            |           -1 |         13457 |          480 |          1 |          1663 |      1 | template1 |     10 |        6 | en_US.utf8 | en_US.utf8 | t             | t            |           -1 |         13457 |          480 |          1 |          1663 | {=c/admin,admin=CTc/admin} 13457 | template0 |     10 |        6 | en_US.utf8 | en_US.utf8 | t             | f            |           -1 |         13457 |          480 |          1 |          1663 | {=c/admin,admin=CTc/admin} 16386 | test-db   |     10 |        6 | en_US.utf8 | en_US.utf8 | f             | t            |           -1 |         13457 |          480 |          1 |          1663 | {=Tc/admin,admin=CTc/admin,"\"test-admin-user\"=C*T*c*/admin","\"test-simple-user\"=c/\"test-admin-user\""}(5 rows)===> Command text at Mon 23 Oct 2023 05:15:53 AM UTC:\l===> DBMS response at Mon 23 Oct 2023 05:15:53 AM UTC:                                        List of databases   Name    | Owner | Encoding |  Collate   |   Ctype    |           Access privileges            -----------+-------+----------+------------+------------+---------------------------------------- postgres  | admin | UTF8     | en_US.utf8 | en_US.utf8 |  template0 | admin | UTF8     | en_US.utf8 | en_US.utf8 | =c/admin                              +           |       |          |            |            | admin=CTc/admin template1 | admin | UTF8     | en_US.utf8 | en_US.utf8 | =c/admin                              +           |       |          |            |            | admin=CTc/admin test      | admin | UTF8     | en_US.utf8 | en_US.utf8 |  test-db   | admin | UTF8     | en_US.utf8 | en_US.utf8 | =Tc/admin                             +           |       |          |            |            | admin=CTc/admin                       +           |       |          |            |            | "test-admin-user"=C*T*c*/admin        +           |       |          |            |            | "test-simple-user"=c/"test-admin-user"(5 rows)===> Command text at Mon 23 Oct 2023 05:15:54 AM UTC:\dt===> DBMS response at Mon 23 Oct 2023 05:15:54 AM UTC:             List of relations Schema |  Name   | Type  |      Owner      --------+---------+-------+----------------- public | clients | table | test-admin-user public | orders  | table | test-admin-user(2 rows)===> Command text at Mon 23 Oct 2023 05:15:55 AM UTC:\d+ Clients===> DBMS response at Mon 23 Oct 2023 05:15:55 AM UTC:                                                         Table "public.clients"  Column  |          Type          | Collation | Nullable |               Default               | Storage  | Stats target | Description ----------+------------------------+-----------+----------+-------------------------------------+----------+--------------+------------- id       | integer                |           | not null | nextval('clients_id_seq'::regclass) | plain    |              |  name     | character varying(255) |           |          |                                     | extended |              |  country  | character varying(255) |           |          |                                     | extended |              |  order_id | integer                |           |          |                                     | plain    |              | Indexes:    "clients_pkey" PRIMARY KEY, btree (id)    "clients_country" btree (country)Foreign-key constraints:    "client_order_fk" FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADEAccess method: heap===> Command text at Mon 23 Oct 2023 05:15:56 AM UTC:\d+ Orders===> DBMS response at Mon 23 Oct 2023 05:15:56 AM UTC:                                                        Table "public.orders" Column |          Type          | Collation | Nullable |              Default               | Storage  | Stats target | Description --------+------------------------+-----------+----------+------------------------------------+----------+--------------+------------- id     | integer                |           | not null | nextval('orders_id_seq'::regclass) | plain    |              |  name   | character varying(255) |           |          |                                    | extended |              |  price  | integer                |           |          |                                    | plain    |              | Indexes:    "orders_pkey" PRIMARY KEY, btree (id)Referenced by:    TABLE "clients" CONSTRAINT "client_order_fk" FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADEAccess method: heap===> Command text at Mon 23 Oct 2023 05:15:57 AM UTC:SELECT * FROM information_schema.table_privileges WHERE grantee<>'PUBLIC' and table_catalog='test-db'===> DBMS response at Mon 23 Oct 2023 05:15:57 AM UTC:     grantor     |     grantee      | table_catalog | table_schema | table_name | privilege_type | is_grantable | with_hierarchy -----------------+------------------+---------------+--------------+------------+----------------+--------------+---------------- test-admin-user | test-admin-user  | test-db       | public       | orders     | INSERT         | YES          | NO test-admin-user | test-admin-user  | test-db       | public       | orders     | SELECT         | YES          | YES test-admin-user | test-admin-user  | test-db       | public       | orders     | UPDATE         | YES          | NO test-admin-user | test-admin-user  | test-db       | public       | orders     | DELETE         | YES          | NO test-admin-user | test-admin-user  | test-db       | public       | orders     | TRUNCATE       | YES          | NO test-admin-user | test-admin-user  | test-db       | public       | orders     | REFERENCES     | YES          | NO test-admin-user | test-admin-user  | test-db       | public       | orders     | TRIGGER        | YES          | NO test-admin-user | test-admin-user  | test-db       | public       | clients    | INSERT         | YES          | NO test-admin-user | test-admin-user  | test-db       | public       | clients    | SELECT         | YES          | YES test-admin-user | test-admin-user  | test-db       | public       | clients    | UPDATE         | YES          | NO test-admin-user | test-admin-user  | test-db       | public       | clients    | DELETE         | YES          | NO test-admin-user | test-admin-user  | test-db       | public       | clients    | TRUNCATE       | YES          | NO test-admin-user | test-admin-user  | test-db       | public       | clients    | REFERENCES     | YES          | NO test-admin-user | test-admin-user  | test-db       | public       | clients    | TRIGGER        | YES          | NO test-admin-user | test-simple-user | test-db       | public       | orders     | INSERT         | NO           | NO test-admin-user | test-simple-user | test-db       | public       | orders     | SELECT         | NO           | YES test-admin-user | test-simple-user | test-db       | public       | orders     | UPDATE         | NO           | NO test-admin-user | test-simple-user | test-db       | public       | orders     | DELETE         | NO           | NO test-admin-user | test-simple-user | test-db       | public       | clients    | INSERT         | NO           | NO test-admin-user | test-simple-user | test-db       | public       | clients    | SELECT         | NO           | YES test-admin-user | test-simple-user | test-db       | public       | clients    | UPDATE         | NO           | NO test-admin-user | test-simple-user | test-db       | public       | clients    | DELETE         | NO           | NO(22 rows)```## Задача 3Содержимое функции task3:```task3(){        ./dbms.sh pg "" sql_file user.env task3.sql;}```Скрипт использует файл [task3.sql](src/task3.sql) для хранения DML операторов наполнения базы данных новыми записями.Лог выполнения скрипта:```===> SQL query text at Mon 23 Oct 2023 05:15:58 AM UTC:SELECT current_user;SELECT session_user;SELECT current_database();INSERT INTO public.Orders(Name, Price) VALUES    ('Шоколад', 10),    ('Принтер', 3000),    ('Книга', 500),    ('Монитор', 7000),    ('Гитара', 4000);SELECT count(*) FROM Orders;    INSERT INTO public.Clients(Name, Country, Order_ID) VALUES    ('Иванов Иван Иванович', 'USA', null),    ('Петров Петр Петрович', 'Canada', null),    ('Иоганн Себастьян Бах', 'Japan', null),    ('Ронни Джеймс Дио', 'Russia', null),    ('Ritchie Blackmore', 'Russia', null);SELECT count(*) FROM Clients;===> DBMS response at Mon 23 Oct 2023 05:15:59 AM UTC:   current_user   ------------------ test-simple-user(1 row)   session_user   ------------------ test-simple-user(1 row) current_database ------------------ test-db(1 row)INSERT 0 5 count -------     5(1 row)INSERT 0 5 count -------     5(1 row)```## Задача 4Содержимое функции task4:```task4(){        ./dbms.sh pg "" sql_file user.env task4.sql;}```Для обновления данных в соответствии с паттерном DRY я создал хранимую процедуру, определенную в скрипте task2b.sql:```CREATE OR REPLACE PROCEDURE UpdateClient(ClientName VARCHAR(255), OrderName VARCHAR(255))LANGUAGE SQLAS $$        UPDATE Clients         SET Order_id = (SELECT ID from Orders WHERE Orders.name=OrderName)         WHERE Clients.Name=ClientName;```А для EXPLAIN из следующей задачи я создал VIEW (тоже из-за DRY):```CREATE OR REPLACE VIEW OrderingClients AS SELECT C.*, O.Name OrderName, O.Price FROM Clients C LEFT JOIN Orders O ON C.Order_ID = O.ID WHERE C.Order_ID is not null;```Лог выполнения скрипта:```===> SQL query text at Mon 23 Oct 2023 05:16:00 AM UTC:CALL UpdateClient('Иванов Иван Иванович', 'Книга');CALL UpdateClient('Петров Петр Петрович', 'Монитор');CALL UpdateClient('Иоганн Себастьян Бах', 'Гитара');CREATE OR REPLACE VIEW OrderingClients AS SELECT C.*, O.Name OrderName, O.Price FROM Clients C LEFT JOIN Orders O ON C.Order_ID = O.ID WHERE C.Order_ID is not null;SELECT * FROM OrderingClients;===> DBMS response at Mon 23 Oct 2023 05:16:00 AM UTC:CALLCALLCALLCREATE VIEW id |         name         | country | order_id | ordername | price ----+----------------------+---------+----------+-----------+-------  1 | Иванов Иван Иванович | USA     |        3 | Книга     |   500  2 | Петров Петр Петрович | Canada  |        4 | Монитор   |  7000  3 | Иоганн Себастьян Бах | Japan   |        5 | Гитара    |  4000(3 rows)```## Задача 5Содержимое функции task5:```task5(){        ./dbms.sh pg "" sql_file user.env task5.sql;}```EXPLAIN я применяю не к оригинальному запросу, а к ранее созданному представлению OrderingClients, чтобы сократить объём повторяемого кода.Лог выполнения скрипта:```===> SQL query text at Mon 23 Oct 2023 05:16:01 AM UTC:EXPLAIN SELECT * FROM OrderingClients;===> DBMS response at Mon 23 Oct 2023 05:16:01 AM UTC:                                QUERY PLAN                                -------------------------------------------------------------------------- Hash Right Join  (cost=11.57..24.20 rows=70 width=1560)   Hash Cond: (o.id = c.order_id)   ->  Seq Scan on orders o  (cost=0.00..11.40 rows=140 width=524)   ->  Hash  (cost=10.70..10.70 rows=70 width=1040)         ->  Seq Scan on clients c  (cost=0.00..10.70 rows=70 width=1040)               Filter: (order_id IS NOT NULL)(6 rows)```Объяснение вывода EXPLAIN:1) Это Hash Right Join между таблицами Orders и Clients. 2) JOIN условие O.ID = C.Order_ID. 3) Запрос сначала выполняет последовательное сканирование по таблице Orders 4) Hash функция используется для построения hash таблицы на базе таблицы Clients. JOIN потом осуществляется именно по этим хэш значениям записей. Результат JOIN содержит 70 записей. Стоимость такого запроса: 11.57..24.205) Теперь последовательное сканирование по таблице Clients.6) Фильтр по условию Order_ID IS NOT NULLВ принципе, наверно, можно было сделать и INNER JOIN, чтобы избежать необходимости фильтрации по непустому значению поля Order_ID.Но пока вопрос оптимизации производительности остро не стоит, я предпочитаю использовать наиболее логичные с моей точки зрения SQL конструкции, наиболее читаемые и понятные, возможно в ущерб плану выполнения, выбираемому оптимизатором запросов СУБД.## Задача 6Содержимое функции task6:```task6(){        BackupFile="backup8";#        ./compose.sh start postgres;#        ./compose.sh inspect PostgreSQL;        ./dbms.sh pg "" backup postgres.env $BackupFile;        ./compose.sh stop postgres;        clean_service_state postgres2;        ./compose.sh start postgres2;        ./compose.sh inspect PostgreSQL2;        ./dbms.sh pg "PostgreSQL2" wait_ready;        ./dbms.sh pg "PostgreSQL2" create_db "" "test-db2";        ./dbms.sh pg "PostgreSQL2" restore "postgres2.env" $BackupFile; # --no-owner; # --create        show_db_objects postgres2.env PostgreSQL2;        clean_service_state postgres2;}```Сначала бэкапится база данных в первом контейнере PostgreSQL (сервис Compose postgres), потом этот контейнер останавливается.Теперь полностью удаляется контейнер PostgreSQL2 (сервис Compose postgres2) и очищается его volume для данных СУБД, далее контейнер PostgreSQL2 создаётся заново и сразу же запускается, ожидается доступность СУБД для обработки запросов, после чего создаётся пустая база данных test-db2, куда восстанавливается бэкап базы, созданный ранее в первом контейнере PostgreSQL. Далее с помощью функции show_db_objects выводится листинг объектов только что восстановленной базы данных test-db2. В самом конце контейнер PostgreSQL2 и его состояние опять удаляются.Лог выполнения скрипта:```===> Debug at Mon 23 Oct 2023 06:07:51 AM UTC:+++ docker-compose up -d postgresPostgreSQL is up-to-dateCONTAINER ID   IMAGE                     COMMAND                  CREATED          STATUS          PORTS                    NAMES147eeebba847   postgres:12.16-bullseye   "docker-entrypoint.s…"   42 seconds ago   Up 38 seconds   0.0.0.0:5432->5432/tcp   PostgreSQL===> Debug at Mon 23 Oct 2023 06:07:54 AM UTC:+++ docker inspect PostgreSQL            "Env": [                "POSTGRES_USER=admin",                "POSTGRES_PASSWORD=admin",                "POSTGRES_DB=test",                "PGDATA=/var/lib/postgresql/data/pgdata",                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/lib/postgresql/12/bin",                "GOSU_VERSION=1.16",                "LANG=en_US.utf8",                "PG_MAJOR=12",                "PG_VERSION=12.16-1.pgdg110+1"            ],CONTAINER ID   IMAGE                     COMMAND                  CREATED          STATUS          PORTS                    NAMES147eeebba847   postgres:12.16-bullseye   "docker-entrypoint.s…"   42 seconds ago   Up 39 seconds   0.0.0.0:5432->5432/tcp   PostgreSQL===> Backup at Mon 23 Oct 2023 06:07:55 AM UTC:+++ docker exec -it PostgreSQL bash -lc '                                pg_dumpall --globals-only -U admin > /mnt/backup/backup8.dumpall_globals;                                pg_dump --column-inserts --format=custom -U admin -d test-db > /mnt/backup/backup8.pg_restore                        '===> Debug at Mon 23 Oct 2023 06:07:56 AM UTC:+++ docker-compose stop postgresStopping PostgreSQL ... doneCONTAINER ID   IMAGE                     COMMAND                  CREATED          STATUS                              PORTS     NAMES147eeebba847   postgres:12.16-bullseye   "docker-entrypoint.s…"   47 seconds ago   Exited (0) Less than a second ago             PostgreSQL===> Debug at Mon 23 Oct 2023 06:07:59 AM UTC:+++ docker-compose stop postgres2CONTAINER ID   IMAGE                     COMMAND                  CREATED          STATUS                     PORTS     NAMES147eeebba847   postgres:12.16-bullseye   "docker-entrypoint.s…"   49 seconds ago   Exited (0) 2 seconds ago             PostgreSQL===> Debug at Mon 23 Oct 2023 06:08:01 AM UTC:Deleted Containers:147eeebba847f8a2ca42989985ea3a227a7a59fda8c5cff12998340a6a8d258aDeleted Networks:netology_defaultTotal reclaimed space: 0BCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES===> Debug at Mon 23 Oct 2023 06:08:04 AM UTC:+++ docker-compose up -d postgres2Creating network "netology_default" with the default driverCreating PostgreSQL2 ... doneCONTAINER ID   IMAGE                     COMMAND                  CREATED         STATUS                  PORTS                    NAMES5614e46263d9   postgres:12.16-bullseye   "docker-entrypoint.s…"   3 seconds ago   Up Less than a second   0.0.0.0:5432->5432/tcp   PostgreSQL2===> Debug at Mon 23 Oct 2023 06:08:09 AM UTC:+++ docker inspect PostgreSQL2            "Env": [                "POSTGRES_USER=admin",                "POSTGRES_PASSWORD=admin",                "POSTGRES_DB=test",                "PGDATA=/var/lib/postgresql/data/pgdata",                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/lib/postgresql/12/bin",                "GOSU_VERSION=1.16",                "LANG=en_US.utf8",                "PG_MAJOR=12",                "PG_VERSION=12.16-1.pgdg110+1"            ],CONTAINER ID   IMAGE                     COMMAND                  CREATED         STATUS        PORTS                    NAMES5614e46263d9   postgres:12.16-bullseye   "docker-entrypoint.s…"   4 seconds ago   Up 1 second   0.0.0.0:5432->5432/tcp   PostgreSQL2===> Waiting DBMS to start at Mon 23 Oct 2023 06:08:10 AM UTC:/var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - no response ... waiting 1s ... /var/run/postgresql:5432 - accepting connections===> Create database:+++ docker exec -it PostgreSQL2 createdb -U admin test-db2===> Restore at Mon 23 Oct 2023 06:08:30 AM UTC:+++ docker exec -it PostgreSQL2 bash -lc '                                psql -U admin -d test-db2 < /mnt/backup/backup8.dumpall_globals;                                pg_restore  --verbose -U admin --dbname=test-db2 /mnt/backup/backup8.pg_restore                        'SETSETSETERROR:  role "admin" already existsALTER ROLECREATE ROLEALTER ROLECREATE ROLEALTER ROLEpg_restore: connecting to database for restorepg_restore: creating PROCEDURE "public.updateclient(character varying, character varying)"pg_restore: creating TABLE "public.clients"pg_restore: creating SEQUENCE "public.clients_id_seq"pg_restore: creating SEQUENCE OWNED BY "public.clients_id_seq"pg_restore: creating TABLE "public.orders"pg_restore: creating VIEW "public.orderingclients"pg_restore: creating SEQUENCE "public.orders_id_seq"pg_restore: creating SEQUENCE OWNED BY "public.orders_id_seq"pg_restore: creating DEFAULT "public.clients id"pg_restore: creating DEFAULT "public.orders id"pg_restore: processing data for table "public.clients"pg_restore: processing data for table "public.orders"pg_restore: executing SEQUENCE SET clients_id_seqpg_restore: executing SEQUENCE SET orders_id_seqpg_restore: creating CONSTRAINT "public.clients clients_pkey"pg_restore: creating CONSTRAINT "public.orders orders_pkey"pg_restore: creating INDEX "public.clients_country"pg_restore: creating FK CONSTRAINT "public.clients client_order_fk"pg_restore: creating ACL "public.TABLE clients"pg_restore: creating ACL "public.SEQUENCE clients_id_seq"pg_restore: creating ACL "public.TABLE orders"pg_restore: creating ACL "public.SEQUENCE orders_id_seq"===> Command text at Mon 23 Oct 2023 06:08:32 AM UTC:SELECT * FROM pg_database===> DBMS response at Mon 23 Oct 2023 06:08:32 AM UTC:  oid  |  datname  | datdba | encoding | datcollate |  datctype  | datistemplate | datallowconn | datconnlimit | datlastsysoid | datfrozenxid | datminmxid | dattablespace |           datacl           -------+-----------+--------+----------+------------+------------+---------------+--------------+--------------+---------------+--------------+------------+---------------+---------------------------- 13458 | postgres  |     10 |        6 | en_US.utf8 | en_US.utf8 | f             | t            |           -1 |         13457 |          480 |          1 |          1663 |  16384 | test      |     10 |        6 | en_US.utf8 | en_US.utf8 | f             | t            |           -1 |         13457 |          480 |          1 |          1663 |      1 | template1 |     10 |        6 | en_US.utf8 | en_US.utf8 | t             | t            |           -1 |         13457 |          480 |          1 |          1663 | {=c/admin,admin=CTc/admin} 13457 | template0 |     10 |        6 | en_US.utf8 | en_US.utf8 | t             | f            |           -1 |         13457 |          480 |          1 |          1663 | {=c/admin,admin=CTc/admin} 16385 | test-db2  |     10 |        6 | en_US.utf8 | en_US.utf8 | f             | t            |           -1 |         13457 |          480 |          1 |          1663 | (5 rows)===> Command text at Mon 23 Oct 2023 06:08:33 AM UTC:\l===> DBMS response at Mon 23 Oct 2023 06:08:33 AM UTC:                             List of databases   Name    | Owner | Encoding |  Collate   |   Ctype    | Access privileges -----------+-------+----------+------------+------------+------------------- postgres  | admin | UTF8     | en_US.utf8 | en_US.utf8 |  template0 | admin | UTF8     | en_US.utf8 | en_US.utf8 | =c/admin         +           |       |          |            |            | admin=CTc/admin template1 | admin | UTF8     | en_US.utf8 | en_US.utf8 | =c/admin         +           |       |          |            |            | admin=CTc/admin test      | admin | UTF8     | en_US.utf8 | en_US.utf8 |  test-db2  | admin | UTF8     | en_US.utf8 | en_US.utf8 | (5 rows)===> Command text at Mon 23 Oct 2023 06:08:34 AM UTC:\dt===> DBMS response at Mon 23 Oct 2023 06:08:34 AM UTC:             List of relations Schema |  Name   | Type  |      Owner      --------+---------+-------+----------------- public | clients | table | test-admin-user public | orders  | table | test-admin-user(2 rows)===> Command text at Mon 23 Oct 2023 06:08:35 AM UTC:\d+ Clients===> DBMS response at Mon 23 Oct 2023 06:08:35 AM UTC:                                                         Table "public.clients"  Column  |          Type          | Collation | Nullable |               Default               | Storage  | Stats target | Description ----------+------------------------+-----------+----------+-------------------------------------+----------+--------------+------------- id       | integer                |           | not null | nextval('clients_id_seq'::regclass) | plain    |              |  name     | character varying(255) |           |          |                                     | extended |              |  country  | character varying(255) |           |          |                                     | extended |              |  order_id | integer                |           |          |                                     | plain    |              | Indexes:    "clients_pkey" PRIMARY KEY, btree (id)    "clients_country" btree (country)Foreign-key constraints:    "client_order_fk" FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADEAccess method: heap===> Command text at Mon 23 Oct 2023 06:08:37 AM UTC:\d+ Orders===> DBMS response at Mon 23 Oct 2023 06:08:37 AM UTC:                                                        Table "public.orders" Column |          Type          | Collation | Nullable |              Default               | Storage  | Stats target | Description --------+------------------------+-----------+----------+------------------------------------+----------+--------------+------------- id     | integer                |           | not null | nextval('orders_id_seq'::regclass) | plain    |              |  name   | character varying(255) |           |          |                                    | extended |              |  price  | integer                |           |          |                                    | plain    |              | Indexes:    "orders_pkey" PRIMARY KEY, btree (id)Referenced by:    TABLE "clients" CONSTRAINT "client_order_fk" FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADEAccess method: heap===> Command text at Mon 23 Oct 2023 06:08:38 AM UTC:SELECT * FROM information_schema.table_privileges WHERE grantee<>'PUBLIC' and table_catalog='test-db'===> DBMS response at Mon 23 Oct 2023 06:08:38 AM UTC: grantor | grantee | table_catalog | table_schema | table_name | privilege_type | is_grantable | with_hierarchy ---------+---------+---------------+--------------+------------+----------------+--------------+----------------(0 rows)===> Debug at Mon 23 Oct 2023 06:08:39 AM UTC:+++ docker-compose stop postgres2Stopping PostgreSQL2 ... doneCONTAINER ID   IMAGE                     COMMAND                  CREATED          STATUS                              PORTS     NAMES5614e46263d9   postgres:12.16-bullseye   "docker-entrypoint.s…"   35 seconds ago   Exited (0) Less than a second ago             PostgreSQL2===> Debug at Mon 23 Oct 2023 06:08:41 AM UTC:Deleted Containers:5614e46263d91f8423defb642b450f8d242ae1516718619c9a392cee0ef709f3Deleted Networks:netology_defaultTotal reclaimed space: 0BCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES===> Debug at Mon 23 Oct 2023 06:08:45 AM UTC:+++ docker-compose stop postgresCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES===> Debug at Mon 23 Oct 2023 06:08:47 AM UTC:Total reclaimed space: 0BCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES```