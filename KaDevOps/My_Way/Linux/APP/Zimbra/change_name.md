<!-- Остановите все процессы Zimbra и выполните резервное копирование /opt/zimbra и всех связанных (в смысле с использованием символических ссылок) каталогов. Подробнее о создании резервной копии в Zimbra wiki раздел:Backup And Restore. Для выполнения этих процедур запуститите следующие команды от имени суперпользователя:
Остановка процессов Zimbra -->

su - zimbra -c "zmcontrol stop"

<!-- Убедимся что все процессы завершились, вывод следующей команды должен быть пустым. -->

ps aux | grep [z]imbra

<!-- Выполним копирование. -->

cp -rp /opt/zimbra /opt/zimbra-backup/

<!-- или -->

rsync -a /opt/zimbra /opt/zimbra-backup/

<!-- Вы должны добавить запись с новым именем в DNS прежде чем запускать zmservername, если вы еще этого не сделали — сделайте это сейчас.
Внимание: если текущий сервер является зеркалом «продакшн» сервера, прервите связь между тестовым и основным сервером, что бы выполнение команды не затронуло основной сервер.
И главное с чем могут возникнуть проблемы, убедитесь что в вашем файле hosts нет записей вида -->

127.0.1.1 mail.hostname.tld mail

<!-- потому как в процессе реконфигурации запускается процесс LDAP который привязывается только в публичному IP, а все обращения в процессе реконфигурации идут только по имени, и если у вас имеется привязка FQDN имени к loopback адресу — вы получите ошибку на подобии этой: -->

Starting ldap…done.
Unable to contact ldap://mail.oldhost.tld:389: Connection refused
Unable to contact ldap://mail.oldhost.tld:389: Connection refused

<!-- Таким образом ваш файл hosts до реконфигурации должен выглядеть примерно так:

127.0.0.1    localhost
111.222.333.444   mail.oldhost.tld mail
111.222.333.444   mail.newhost.tld
Если вы уже получили вышеприведенную ошибку
остановите сервисы Zimbra -->

su - zimbra -c "zmcontrol stop"

<!-- «добейте» оставшиеся процессы -->

ps aux | grep [z]imbra | awk '{print $2}' | xargs kill -9

<!-- удалите папку с конфигами -->

rm -rf /opt/zimbra/conf/

<!-- скопируйте папку с конфигами из резервной копии -->

cp -rp /opt/zimbra-backup/conf/ /opt/zimbra/

<!-- запустите Zimbra -->

su - zimbra -c "zmcontrol start"

<!-- выполните шаги из предыдущего пункта, и переходите к смене имени хоста
Наконец, для смены имени выполните следующие команды: -->

su - zimbra -c "/opt/zimbra/libexec/zmsetservername -n %newservername%"

<!-- Настройте ОС на использование нового имени хоста. Очень важно сделать это после 3-го шага.
Перезагрузитесь. Хотя на самом деле это не обязательно, обычно достаточно просто запустить Zimbra командой -->

su - zimbra -c "zmcontrol start"

<!-- Внимание: если вы используете многосерверную конфигурацию, убедитесь что все отсылки к старому имени были заменены на новое имя на всех серверах, после этого перезапустите сервисы на всех серверах.
Используйте zmlocalconfig и zmprov чтоб вручную проверить основные настройки, настройки сервера, пользователей и т.д. на предмет «следов» старого имени. -->

zmprov gacf | grep mail.local
zmprov gs `zmhostname` | grep mail.local
zmlocalconfig | grep mail.local

<!-- Удалите записи со старым именем из DNS.
Так может выглядеть ваш файл hosts после реконфигурации: -->

127.0.0.1 localhost
111.222.333.444 mail.newhost.tld mail

<!-- После изменения имени могут возникнуть ошибки связанные с сертификатами.Также переименовать нато записи старого сервера. Иначе PROXY не запуститься -->

nano /opt/zimbra/conf/nginx/includes/nginx.conf.web

<!-- Starting proxy...Failed.
Starting proxy...sudo: unable to resolve host mail.local: Name or service not known
nginx: [emerg] host not found in upstream "snabavangard.ru:8080" in /opt/zimbra/conf/nginx/includes/nginx.conf.web:27
failed. -->
