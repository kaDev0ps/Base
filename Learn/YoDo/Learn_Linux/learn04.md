## Изменение группы. При создании файла, владелец user1

newgrp user1

# Скрипт и Bash сценарии

- выводим список всех файлов и фильтруем только системные
  ls -A |grep '^\.'

> Любые команды это скрипт!
> Скрипты есть однострочные и в файле
> Правило хорошего тона ставить расширение в зависимости на чем будет скрипт

## Выполнение скрипта

bash script.sh

- Или сделать файл исполняемым и запустить его
  chmod +x script.sh

> Прописать абсолютный путь до файла /home/user/script.sh
> Запустить из текущего каталога ./script.sh

## Чтобы система поняла интерпритатор через который мы будем выплнять скрипт надо указать к неу путь

## Сделать запись лога

#!/bin/bash -x
ls -A |grep '^\.'

## Создание переменных BASH

a=123
echo $a

### Переменные окружения

env
SHELL=/bin/bash - переменная интерпритатора
PATH - путь где хранятся скрипты

### Добавления своего каталога для исполняемых файлов

PATH=$PATH:/home/user

- Проверяем что добавился
  env |grep PATH

- Чтобы после разрыва сессии настройки сохранились надо зайти в bashrc и дописать PATH или в каталоге profile. Если глобально то в каталоге etc
  vim .bashrc

- Все переменные это строки
  a=123
  b=1234
  c=$a+$b = 123+1234

## Вызов переменной

a="Hello world"
echo $a

- Способ использования команды
  a=`ls -l` или a=$(ls)

## Арифметические выражения

a=2
b=3
c=$(($a+$b))

## Системные переменные $0 и $9

Создаем скрипт

    vim script.sh
    dir=$1
    mkdir $dir

Запускаем скрипт
script.sh test_dir

У нас переменная dir подхватила значения test_dir и создался каталог

## Системные переменные для проверки условий

    echo $?

Любое значение отличное от 0 это ЛОЖЬ

## Оператор IF

if [] команда man test
-e проверяем существования файла
-d проверяем существования каталога

    if [ -e file50]
    then
        echo "Существует такой файл"
    else
        touch file50
    fi

## Проверка строк в файле

-z если строка пуста то ИСТИНА

- Если переменная dir пустая, то выводим сообщение, в противном случае, создаем директорию
  dir=$1
  if [ -z $dir ]
  then
  echo "error"
  exit
  else
  fi

- Пареметр передаем командой bash script.sh PARAMETR-NAME

## Проверка каталога любого названия

ls -l /test
if [ $? -ne 0 ]
then
echo "error"
exit
fi

## Создание команды в одну строку

- Мы создали файл и написали текст, которые отправили в этот файл
  touch file; echo "test" > file
- Мы создали файл и текст отправится в него только если файл создасться
  touch file && echo "test" > file
- Если первая команда не выполниться, то выполнится вторая
  touch file && echo "test" > file

- Выполняем проверку обновления и в случае успеха проводим установку с согласием
  apt update && apt upgrade -y

## Работа с циклами

for i in $(ls); do echo $i;done

## Выполнение условия пока

while [ true ]; do echo "false";

## Планировщик заданий cron и at

- at - выполнить задачу разово в определенное время

  at -f /home/user/at.sh -m 10:30

- Дата также может быть указана в нескольких форматах, включая ММ/ДД/ГГ.
  man at

- Cron - выполняется в определенное время или через определенный промежуток времени
- Весь список заданий содержится в /etc/crontab
- Можем запустить задачу от нашего пользователя, которая будет выполняться в определенное время каждый день,месяц год
  (не всегда работает)
  crontab -e
  02 10 \* \* \* /sbin/reboot
- Посмотреть весь список заданий
  cd /var/spool/cron
- Посмотреть задания конкретног пользователя
  crontab -u user -l

# Примеры

<!-- Каждую минуту -->

- - - - - /usr/local/bin/serve
          <!-- Далее, усложним, будем запускать каждый час, в нулевую минуту: -->
          0 \* \* \* \* /usr/local/bin/serve
          <!-- Запускаем в нулевую минуту нулевого часа, каждый день, это в 12 ночи: -->
          0 0 \* \* \* /usr/local/bin/serve
          <!-- Если идти так дальше, то можно запускать в первый день каждого месяца: -->
          0 0 1 \* \* /usr/local/bin/serve
          <!-- Можно в любой день, например, 15 числа: -->
          0 0 15 \* \* /usr/local/bin/serve
          <!-- В первый день недели первого месяца года, 0 часов 0 минут: -->
          0 0 \* 1 0 /usr/local/bin/serve

- - - - - /home/ka/qr-sync.bash
          multiotp -debug -display-log -ldap-users-sync
